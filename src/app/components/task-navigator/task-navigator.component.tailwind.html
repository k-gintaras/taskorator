<div class="flex flex-col md:flex-row h-screen">
  <!-- Artificer sidebar - vertical on md+, horizontal sticky top on mobile -->
  <div
    *ngIf="showArtificer"
    class="bg-base-200 md:w-16 w-full md:h-full sticky top-0 md:top-16 flex md:flex-col"
  >
    <app-artificer
      class="flex md:flex-col flex-row md:space-y-2 space-x-2 p-2 md:p-4 w-full md:w-auto"
    ></app-artificer>
  </div>

  <!-- Task list main area -->
  <div
    class="flex-1 overflow-y-auto p-4 space-y-4 bg-base-100"
    style="min-width: 0"
  >
    <div *ngIf="tasks?.length === 0" class="text-center text-gray-500 mt-20">
      <app-task-edit
        [task]="selectedOverlord"
        [isPopup]="false"
      ></app-task-edit>
      <p class="mt-4">No other tasks yet.</p>
    </div>

    <div *ngIf="canShowInfo()" class="mb-4">
      <app-task-card [task]="selectedOverlord"></app-task-card>
    </div>

    <div
      *ngFor="let task of tasks"
      class="flex items-center border rounded-lg p-3 shadow-sm"
      [class.border-primary]="isSelected(task)"
      [class.bg-primary]="isSelected(task)"
      [class.text-white]="isSelected(task)"
      [style.borderLeftColor]="getDateBasedColor(task.timeCreated)"
    >
      <!-- Left: navigation button -->
      <button
        class="btn btn-square btn-ghost text-lg shrink-0 mr-3"
        (click)="onNext(task)"
        aria-label="Next Task"
      >
        <mat-icon>arrow_forward</mat-icon>
      </button>

      <!-- Middle: Task mini info and optionally more -->
      <div class="flex-1 min-w-0">
        <app-task-mini [task]="task"></app-task-mini>
        <div *ngIf="isShowMoreEnabled()" class="text-xs text-gray-600 truncate">
          {{ task.why }} - {{ task.todo }}
        </div>
      </div>

      <!-- Right: Artificer actions for this task -->
      <div class="ml-3 shrink-0">
        <app-artificer-action
          [treeNode]="getTreeNodeData(task)"
          [task]="task"
        ></app-artificer-action>
      </div>
    </div>
  </div>
</div>
